<?xml version="1.0" encoding="ASCII"?> 
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [


<!ENTITY RFC2119 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>

<!--<!ENTITY RFC1652 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.1652.xml'>-->
<!--<!ENTITY I-D.eai-5378bis PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-5378bis-00.xml'>
<!ENTITY I-D.eai-rfc5721bis PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-rfc5721bis-00.xml'>-->
<!ENTITY RFC2119 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>
<!ENTITY RFC2045 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2045.xml'>
<!ENTITY RFC2046 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2046.xml'>
<!--<!ENTITY RFC2047 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2047.xml'>-->
<!ENTITY RFC2231 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2231.xml'>
<!--<!ENTITY RFC5321 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5321.xml'>-->
<!ENTITY RFC5322 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5322.xml'>
<!ENTITY RFC3629 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3629.xml'>
<!ENTITY RFC4952 PUBLIC ''
   'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4952.xml'>
<!ENTITY RFC5198 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5198.xml'>
<!ENTITY RFC5234 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5234.xml'>
<!-- PKIX -->
<!ENTITY RFC5280 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5280.xml'>
<!-- openPGP -->
<!ENTITY RFC3156 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3156.xml'>
<!ENTITY RFC5863 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5863.xml'>
<!ENTITY RFC5335 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5335.xml'>
<!ENTITY RFC5504 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5504.xml'>	
<!--<!ENTITY I-D.eai-rfc5336bis PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-rfc5336bis-07.xml'>
<!ENTITY I-D.eai-frmwrk-4952bis PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-frmwrk-4952bis-10.xml'>-->
]>

<?rfc rfcedstyle='yes' ?>
<?rfc subcompact='no'  ?>
<?rfc toc='yes'        ?>
<?rfc symrefs="yes"    ?>
<?rfc sortrefs="yes"   ?>

<rfc  ipr='trust200902' category="std" updates="2045,5322" 
	obsoletes="5335" docName="draft-ietf-eai-rfc5335bis-08">

<workgroup>Eail Address Internationalization (EAI)</workgroup>

<front>
<title abbrev="I18N Email Headers">
Internationalized Email Headers
</title>
      <author
         fullname="Abel Yang"
         initials="A."
         surname="Yang">

         <organization>TWNIC</organization>
         <address>
            <postal>
			<street>4F-2, No. 9, Sec 2, Roosevelt Rd.</street>
			<city>Taipei</city>
			<region/>
			<code>100</code>
			<country>Taiwan</country>
            </postal>
            <phone>+886 2 23411313 ext 505 </phone>
            <email>abelyang@twnic.net.tw</email>
            </address>
      </author>

      <author
         fullname="Shawn Steele"
         initials="S.S."
         surname="Steele">
         <organization>Microsoft</organization>
         <address>
            <email>Shawn.Steele@microsoft.com</email>
            </address>
      </author>

      <author
         fullname="D. Crocker"
         initials="D."
         surname="Crocker">
         <organization>Brandenburg InternetWorking</organization>
         <address>
            <postal>
               <street>675 Spruce Dr.</street>
               <city>Sunnyvale</city>
               <country>USA</country>
            </postal>
            <phone>+1.408.246.8253</phone>
            <email>dcrocker@bbiw.net</email>
            <uri>http://bbiw.net</uri>
         </address>
      </author>


      <author
         fullname="Ned Freed"
         initials="N."
         surname="Freed">
         <organization>Oracle</organization>
         <address>
            <postal>
               <street>800 Royal Oaks</street>
               <city>Monrovia</city>
               <code>91016-6347</code>
               <region>CA</region>
               <country>USA</country>
            </postal>
            <email>ned.freed@mrochek.com</email>
          
         </address>
      </author>

      <!--<author
         fullname="Pete Resnick"
         initials="P."
         surname="Resnick">
         <organization>Qualcomm Incorporated</organization>
         <address>
            <postal>
               <street>5775 Morehouse Drive</street>
               <city>San Diego</city>
               <code>92121-1714</code>
               <region>CA</region>
               <country>USA</country>
            </postal>
            <phone>+1 858 651 4478</phone>          
         </address>
      </author>-->
      <date         year="2011"/>
<!--
<date month="January" day="24" year="2011" />
-->

<!-- [rfced] Please insert any keywords (beyond those that appear in
the title) for use on http://www.rfc-editor.org/rfcsearch.html. -->
      <area>Applications</area>
      <workgroup>EAI</workgroup>

      <keyword>I18N Email Header</keyword>
      <keyword>UTF-8 Email Header</keyword>
      <keyword>internationalized Email</keyword>

      <abstract>
         <t> Internet mail was originally limited to 7-bit ASCII. Recent
            enhancements support Unicode's UTF-8 encoding in portions of a
            message. Full internationalization of electronic mail requires
            additional enhancement, including support for UTF-8 in
            user-oriented header fields, such as in the To, From, and Subject
            fields. This document specifies an enhancement to Internet mail
            that permits native UTF-8 support in the header and body of a
            message. </t>
      </abstract>
</front>

<middle>

  <section
         title="Introduction">

         <t>Internet mail distinguishes a message from its transport and
            further divides a message between a header and a body <xref target="RFC5598"/>. 
			Internet mail header fields contain a
            variety of strings that are intended to be user-visible. The range
            of supported characters for these strings was originally limited
            to a subset of <xref
               target="ASCII"/>; globalization of the Internet requires
            support of the much larger set contained in UTF-8 <xref
               target="RFC5198"/>. Complex encoding alternatives to UTF-8, as
            an overlay to the existing ASCII base, would introduce
            inefficiencies as well as opportunities for processing errors.
            Native support for UTF-8 encoding <xref
               target="RFC3629"/> is widely available among systems now used
            over the Internet. Hence supporting this encoding directly within
            email is desired. This document specifies an enhancement to
            Internet mail that permits the use of UTF-8 encoding, rather than
            only ASCII, as the base form for header fields. </t>

         <t>This specification is based on a model of native, end-to-end
            support for UTF-8, which uses an "8-bit clean" environment .
            Support for carriage across legacy, 7-bit infrastructure and for
            processing by 7-bit receivers requires additional mechanisms that
            are not provided by this specification.</t>

         <section
            title="Changes to the 8-bit clean Model<!-- (by DCrocker) -->">

            <!-- [rfced] Please REMOVE this section prior to publication. -->

            <t>This is an extensive revision to the draft. Changes include:<list
                  style="symbols">
                  <t>Greatly simplified ABNF that is much more basic and
                     integrated.</t>
                  <t>Clean separation of the changes in an email header <xref
                        target="RFC5322"/> from those in a MIME header <xref
                        target="RFC2045"/></t>
                  <t>Change to the default MIME content-transfer-encoding to
                     be 8bit</t>
                  <t>Elimination of all discussion of transport</t>
                  <t>An appendix that lists the derived ABNF rules that
                     inherit support UTF-8, due to the changed basic rules</t>
               </list> Still Pending:<list
                  style="symbols">
                  <t>ABF to support IDN</t>
                  <t>Fix "Normalization" section; I could not figure out what
                     it needs to say. I wasn't trying to change the existing
                     spec, but simply fix the writing.</t>
                  <t>Review/fix MIME C-T-E details</t>
               </list>
            </t>

            <t> The goal of the changes is to dramatically simplify the
               specification and the software needed to support a message with
               UTF8 encoding. Rather than specify a wide range of
               UTF8-specific changes to the existing ABNF rules, it focuses on
               the few, underlying ABNF rules that are the basis for
               user-visible ASCII text. The premise for this is simple: If the
               message is to be in UTF-8, then it is in UTF-8. Subtle or
               complex rules that selectively add UTF-8 are not worth the
               effort, once the message has already entered into the realm of
               UTF-8. </t>

            <t>The question, then, is whether this change has planted some
               landmines, such as in Trace header fields? </t>

         </section>
         <section title="Terminology">

            <t> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
               NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
               "OPTIONAL" in this document are to be interpreted as described
               in <xref
                  target="RFC2119"/>. </t>
            <t>Syntax descriptions use Augmented BNF (ABNF) <xref
                  target="RFC5234"/>. </t>

            <t>Basic terms for this specification include:<list>
                  <t><list
                        style="hanging">
                        <t
                           hangText="ASCII:  ">An encoding of Control
                           Characters and Basic Latin that occupies 7-bits,
                           per <xref
                              target="ASCII"/>. Such a string is fully
                           compatible with email as specified in <xref
                              target="RFC5322"/>.</t>
                        <t
                           hangText="UTF-8:  ">An encoding of Unicode in 8-bit
                           bytes, per <xref
                              target="RFC3629"/>.</t>
                     </list>
                  </t>
               </list></t>		
		</section>
</section>

      <section
         title="Support for UTF-8 Encoding">

         <section
            title="Message Object ABNF Changes">

            <t>Internet Mail that conforms to this specification is classed as
               supporting UTF-8. However, UTF-8 characters within the ASCII
               range retain the restrictions defined for original, legacy,
               Latin-only email. Therefore, ABNF enhancements to include UTF-8
               incrementally add the non-ASCII portions of UTF-8 to that
               established base of ASCII.</t>

            <t>UTF-8 characters are defined by using the following ABNF taken
               from <xref
                  target="RFC3629"/>: <figure>
                  <artwork type="abnf"><![CDATA[UTF8-enhancement  =   UTF8-2 / UTF8-3 / UTF8-4

UTF8-2            =   <See Section 4 of RFC3629>

UTF8-3            =   <See Section 4 of RFC3629>
					
UTF8-4            =   <See Section 4 of RFC3629>]]></artwork>
               </figure>
            </t>
         </section>

         <section
            title="Normalization">

            <t> See <xref
                  target="RFC5198"/> for a discussion of normalization. A
               normalized form <xref
                  target="NFC"/> MAY be used. However <xref
                  target="NFC"/> can lose information that is needed to
               correctly spell some names in unusual circumstances.</t>
         </section>

         <section
            title="Content-Transfer-Encoding">

            <t>This specification is based on a requirement for an "8-bit
               clean" infrastructure. Support for UTF-8 semantics within a
               7-bit environment requires translation conventions that are not
               specified here. Consequently a Content-Transfer-Encoding value
               of 7-bit is not useful for a message that is labeled as
               containing UTF-8.</t>
         </section>
      </section>

      <!--         <t>SMTP clients can send header fields in UTF-8 format, if the
            message-utf8 extension is advertised by the SMTP server or is
            permitted by other transport mechanisms. </t>-->

      <!--         <section
            anchor="change_on_mime_header"
            title="Changes on MIME Headers">
            <t> This specification updates Section 6.4 of <xref
                  target="RFC2045"/>. <xref
                  target="RFC2045"/> prohibits applying a
               content-transfer-encoding to any subtypes of "message/". This
               specification relaxes the rule - it allows newly defined MIME
               types to permit content-transfer-encoding, and it allows
               content-transfer-encoding for message/utf8-rfc822 (see <xref
                  target="message-utf8"/>). </t>

            <t> Background: Normally, transfer of message/utf8-rfc822 will be done
               in 8-bit-clean channels, and body parts will have "identity"
               encodings, that is, no decoding is necessary. In the case where
               a message containing a message/utf8-rfc822 is downgraded from 8-bit
               to 7-bit as described in <xref
                  target="RFC1652"/>, an encoding may be applied to the
               message; if the message travels multiple times between a 7-bit
               environment and an environment implementing message-utf8, multiple
               levels of encoding may occur. This is expected to be rarely
               seen in practice, and the potential complexity of other ways of
               dealing with the issue are thought to be larger than the
               complexity of allowing nested encodings where necessary. </t>

         </section>
-->

      <section
         anchor="change-5322"
         title="Internet Message Format Enhancement">

         <t> This section specifies UTF-8 enhancements for the header of an
            Internet Mail message, as defined in <xref
               target="RFC5322"/>. </t>
         <t>ABNF used in this section is taken from that specification and the
            ABNF specification.</t>

         <t> This specification retains the <xref
               target="RFC5322"/> rules for defining header field names. The
            bodies of header fields are allowed to contain UTF-8 characters,
            but the header field names themselves must contain only ASCII
            characters. </t>

         <t>The following rules extend the corresponding rules in <xref
               target="RFC5322"/> and <xref
               target="RFC5234"/> in order to allow additional UTF-8
            characters. <figure>
               <artwork type="abnf"><![CDATA[VCHAR   =/  UTF8-non-ascii
                     
ctext   =/  UTF8-enhancement
                     
atext   =/  UTF8-enhancement

qtext   =/  UTF8-enhancement

TENTATIVE (DCrocker):
text    =/  UTF8-enhancement
               ; note that this upgrades the body to UTF-8

{{ how to add IDN to this? }}
domain  =   dot-atom / domain-literal / obs-domain
]]></artwork>
            </figure>
         </t>

         <t>This means that all the <xref
               target="RFC5322"/> constructs that build upon these will permit
            UTF-8 characters, including comments and quoted strings.<list>
               <t><list
                     style="hanging">
                     <t
                        hangText="&lt;field-name&gt;  "><xref
                           target="RFC5322"/> has the rule &lt;field-name&gt; 
                        which specifies permissible names for user-defined
                        header fields. The current specification defines no
                        changes to that rule.</t>
                     <t
                        hangText="&lt;msg-id&gt; ">This ABNF enables
                        Message-ID strings to be full UTF-8. However the
                        specification directs that Message-ID strings SHOULD
                        be restricted to ASCII.</t>
                  </list></t>
            </list></t>


         <!--<section
            anchor="TraceFieldLimit"
            title="Trace Field Syntax">
            
            <t> The 'uFor' clause in "Received:" fields has been allowed the
            use of internationalized addresses in "For" fields. It is
            described in <xref
            target="I-D.eai-rfc5336bis"/>, Section 3.6.3.
            <!-\-
            by use of the new uFor syntax. UTF-8 information may be needed in "Received:" fields.
            Such information is therefore allowed to preserve the integrity of those 
            fields. The uFor syntax retains the original UTF-8 email address between
            email address internationalization EAI-aware MTAs. 
            
            Note that, no downgrading be required, the uFor parameter
            is dropped per the procedure specified in <xref target="RFC5504"/>.
            -\->
            </t>
            
            <t> The "Return-path" designates the address to which messages
            indicating non-delivery or other mail system failures are to be
            sent.
            <!-\-  SM's comments
            
            The "Return-Path:" field provides the email return address
            in the mail delivery. 
            -\->
            Thus, the header is augmented to carry UTF-8
            addresses<!-\- (see the
            revised syntax of &lt;angle-addr&gt; in <xref
            target="change_addr_spec"/> of this document)-\->.
            This will not break the rule of trace field integrity, because
            the header field is added at the last MTA and described in <xref
            target="RFC5321"/>. </t>
            
            <t> The &lt;received-token&gt; on "Received:" field ( described in
            Section 3.6.7 of <xref
            target="RFC5322"/>) syntax is augmented to allow UTF-8 email
            address in the "For" field. &lt;angle-addr&gt; is augmented to
            include UTF-8 email address. In order to allow UTF-8 email
            addresses in an &lt;addr-spec&gt;, &lt;uAddr-Spec&gt; is added
            to &lt;received-token&gt;. <figure>
            <artwork type="abnf">
            <![CDATA[
            received-token =/ uAddr-Spec                  
            ]]></artwork>
            </figure>
            </t>
            </section>
         -->

         <!--<section
            anchor="change_addr_spec"
            title="Change on addr-spec Syntax">
            <t>Internationalized email addresses are represented in UTF-8.
            Thus, all header fields containing &lt;mailbox&gt;es are
            updated from <xref
            target="RFC5321"/> Section 4.1.2 to permit UTF-8 addresses. <!-\- 
            as well as an additional, optional all-ASCII alternate
            address. Note that Message Submission Servers ("MSAs") and Message 
            Transfer Agents (MTAs) may downgrade internationalized messages as needed.
            The procedure for doing so is described in <xref target="RFC5504"/>.
            -\->
            <!-\-
            The procedure for doing so is described in <xref target="RFC5504" />.
            -\->
            <figure>
            <artwork type="abnf"><![CDATA[
            mailbox	       = name-addr / addr-spec / uAddr-Spec
            ; Replace mailbox in RFC 5322, Section 3.4
            
            angle-addr     =/ [CFWS] "<" uAddr-Spec ">" [CFWS] 
            ; Extending angle-addr in RFC 5322, Section 3.4
            
            uAddr-Spec     = uLocal-Part "@" uDomain            
            
            uLocal-Part    = uDot-Atom / uQuoted-String / obs-local-part
            ; Replace Local-Part in RFC 5322, Section 3.4.1
            
            uQuoted-String = [CFWS] DQUOTE *([FWS] uQcontent) [FWS] DQUOTE [CFWS]
            
            obs-local-part = <See Section 4.4 of RFC 5322>				 
            uDomain        = uDot-Atom / domain-literal / obs-domain
            
            ]]></artwork>
            </figure> Below are a few examples of possible &lt;mailbox&gt;
            representations. <figure>
            <artwork>
            <![CDATA[
            
            "DISPLAY_NAME" <ASCII@ASCII>
            ; traditional mailbox format
            
            "DISPLAY_NAME" <non-ASCII@non-ASCII>
            ; message will be rejected if message-utf8 extension is not supported
            
            <non-ASCII@non-ASCII>
            ; without DISPLAY_NAME and quoted string
            ; message will be rejected if message-utf8 extension is not supported
            
            ]]></artwork>
            </figure>
            </t>
            </section>
         -->
      </section>

      <section
         title="Message Labeling">
         <t>For clarity and convenience, a message SHOULD contain an explicit
            label indicating the character base it uses. This section defines
            a new header field for this label:<figure>
               <artwork type="abnf"><![CDATA[fields         =/ msg-character
msg-character  = "MSG-Char:" ( "ASCII" / "UTF-8" ) CRLF]]></artwork>
            </figure>
         </t>
      </section>
      <section
         anchor="change-2045"
         title="MIME Enhancement">

         <section
            title="Content-Transfer-Encoding">
            <t>The default "Content-Transfer-Encoding: is 8BIT" and is assumed
               if the Content-Transfer-Encoding header field is not
               present.</t>
         </section>

         <section
            title="MIME Header Field">

            <t> MIME contains at least one header field that is intended for
               user display, namely Content-Description. This section
               specifies UTF-8 enhancements to MIME header fields, as defined
               in <xref
                  target="RFC2045"/>. ABNF rules used in this section is taken
               from that specification and the ABNF specification. </t>

            <t>The enhanced ABNF rules are: <figure>
                  <artwork type="abnf"><![CDATA[text    =/ UTF8-non-ascii]]></artwork>
               </figure>
            </t>

         </section>

         <section
            anchor="message-utf8"
            title="Content-Type: message/utf8-rfc822">

            <!--            <t> Internationalized messages MUST only be transmitted as
               authorized by <xref
                  target="I-D.eai-rfc5336bis"/> or within a non-SMTP
               environment which supports these messages. A message is a
               "message/utf8-rfc822 message", if <list
                  style="symbols">
                  <t>it contains UTF-8 header values as specified in this
                     document, or</t>
                  <t>it contains UTF-8 values in the headers fields of body
                     parts. </t>

               </list>
            </t>
-->
            <t> The type message/utf-rfc822 is similar to message/rfc822.
               However it specifies that characters are interpreted as UTF-8
               rather than being limited to ASCII.</t>

            <!--If this type is sent to a 7-bit-only system, it MUST be encoded
               in MIME <xref
                  target="RFC2045"/>. <list
                  style="hanging">
                  <t
                     hangText="NOTE:
                      ">A system
                     compliant with MIME that doesn't recognize
                     message/utf8-rfc822 SHOULD treat it as
                     "application/octet-stream" as described in Section 5.2.4
                     of <xref
                        target="RFC2046"/>.</t>
               </list>
            </t>-->

            <t>
               <list
                  style="hanging">
                  <t
                     hangText="Type name:">message</t>
                  <t
                     hangText="Subtype name:">utf8-rfc822</t>
                  <t
                     hangText="Required parameters:">none</t>
                  <t
                     hangText="Optional parameters:">none</t>
                  <t
                     hangText="Encoding considerations:">Any
                     content-transfer-encoding is permitted. The 8-bit or
                     binary content-transfer-encodings are recommended where
                     permitted.</t>
                  <t
                     hangText="Security considerations:">See <xref
                        target="security"/>.</t>
                  <t
                     hangText="Interoperability considerations:">The media
                     type provides functionality similar to the message/rfc822
                     content type for email messages with international email
                     headers. When there is a need to embed or return such
                     content in another message, there is generally an option
                     to use this media type and leave the content unchanged or
                     down-convert the content to message/rfc822. Both of these
                     choices will interoperate with the installed base, but
                     with different properties. Systems unaware of
                     internationalized headers will typically treat a
                     message/utf8-rfc822 body part as an unknown attachment,
                     while they will understand the structure of a
                     message/rfc822. However, systems that understand
                     message/utf8-rfc822 will provide functionality superior
                     to the result of a down-conversion to message/rfc822. The
                     most interoperable choice depends on the deployed
                     software.</t>

                  <t
                     hangText="Published specification:">RFC &rfc.number;</t>
                  <t
                     hangText="Applications that use this media type:">SMTP
                     servers and email clients that support multipart/report
                     generation or parsing. Email clients which forward
                     messages with international headers as attachments.</t>
                  <t
                     hangText="Additional information:"/>
                  <t
                     hangText="Magic number(s):">none</t>
                  <t
                     hangText="File extension(s):">The extension ".u8msg" is
                     suggested.</t>
                  <t
                     hangText="Macintosh file type code(s):">A uniform type
                     identifier (UTI) of "public.utf8-email-message" is
                     suggested. This conforms to "public.message" and
                     "public.composite-content", but does not necessarily
                     conform to "public.utf8-plain-text".</t>
                  <t
                     hangText="Person &amp; email address to contact for further 
information:">See
                     the Author's Address section of this document.</t>
                  <t
                     hangText="Intended usage:">COMMON</t>
                  <t
                     hangText="Restrictions on usage:">This is a structured
                     media type which embeds other MIME media types. The 8-bit
                     or binary content-transfer-encoding SHOULD be used unless
                     this media type is sent over a 7-bit-only transport.</t>

                  <t
                     hangText="Author:">See the Author's Address section of
                     this document.</t>
                  <t
                     hangText="Change controller:">IETF Standards Process</t>
               </list>
            </t>
         </section>

      </section>
      <section
         anchor="security"
         title="Security Considerations">
         <t> If a user has a mailbox address in UTF-8 and a mailbox address in
            ASCII, a digital certificate that identifies that user might have
            both addresses in the identity. Having multiple email addresses as
            identities in a single certificate is already supported in PKIX
            (Public Key Infrastructure for X.509 Certificates) <xref
               target="RFC5280"/> and OpenPGP <xref
               target="RFC3156"/>. </t>
         <t> Because UTF-8 often requires several octets to encode a single
            character, internationalized local parts and header value may
            cause mail addresses to become longer. As specified in <xref
               target="RFC5322"/>, each line of characters MUST be no more 998
            octets, excluding the CRLF. On the other hand, MDA (Mail Delivery
            Agent) processes that parse, store, or handle email addresses or
            local parts must take extra care not to overflow buffers, truncate
            addresses, or exceed storage allotments. Also, they must take
            care, when comparing, to use the entire lengths of the addresses. </t>
         <!--
<t>
	Because UTF-8 often requires several octets to encode a single
	character, internationalized local parts may cause mail addresses to
	become longer. As specified in <xref target="RFC5322"/>, each line of characters MUST be no more 998 octets, 
	excluding the CRLF.

</t>

<t>
	Because internationalized local parts may cause email addresses to be longer, 
	processes that parse, store, or handle email addresses or local parts must 
	take extra care not to overflow buffers, truncate addresses,
	or exceed storage 
	allotments. Also, they must take care, when comparing, to use the entire
	lengths of the addresses.
</t>

<t>
	In this specification, a user could provide an ASCII alternative address 
	for a non-ASCII address. However, it is possible these two addresses go to 
	different mailboxes, or even different people. 
	This configuration may be based on a user's personal choice or on
	administration policy. We recognize that if ASCII and non-ASCII email is
	delivered to two different destinations, based on MTA capability, this may
	violate the principle of least astonishment, but this is not a "protocol problem".
</t>
-->
         <t> The security impact of UTF-8 headers on email signature systems
            such as Domain Keys Identified Mail (DKIM), S/MIME, and OpenPGP is
            discussed in <xref
               target="I-D.eai-frmwrk-4952bis"/>, Section 14.
            <!--
A subsequent 
document <xref target="RFC5504"/> will cover the impact of downgrading on 
these systems.
-->
         </t>

      </section>


      <section
         anchor="IANA"
         title="IANA Considerations">
         <t> IANA is requested to update the registration of the
            message/utf8-rfc822 MIME type using the registration form
            contained in <xref
               target="message-utf8"/>. </t>

         <!--IANA has registered the message/utf8-rfc822 MIME type
using the registration form contained in <xref target="change_addr_spec" />.
-->


      </section>

      <section
         title="Acknowledgements">

         <t> This document incorporates many ideas first described in
            Internet-Draft form by Paul Hoffman, although many details have
            changed from that earlier work. </t>

         <t> The author especially thanks Jeff Yeh for his efforts and
            contributions on editing previous versions. </t>
         <t> Most of the content of this document is provided by John C
            Klensin. Also, some significant comments and suggestions were
            received from Charles H. Lindsey, Kari Hurtta, Pete Resnick,
            Alexey Melnikov, Chris Newman, Yangwoo Ko, Yoshiro Yoneya, and
            other members of the JET team (Joint Engineering Team) and were
            incorporated into the document. The editor sincerely thanks them
            for their contributions. </t>
      </section>
      <!--     <section
         title="Edit history">
         <!-\-
<t>This section is used for tracking the update of this document. Will be removed after finalize.</t>
-\->
         <t> [[RFC Editor: please remove this section before publishing.]] </t>
         <section
            title="draft-ietf-eai-rfc5335bis-00">
            <t>
               <list
                  style="numbers">
                  <t>Applied Errata suggested by Alfred Hoenes.</t>
                  <t>Adjust [RFC2821] and [RFC2822] to <xref
                        target="RFC5321"/> and <xref
                        target="RFC5322"/>.</t>
                  <t>Abrogate &lt;alt-address&gt; in ABNF of
                     &lt;angle-addr&gt;.</t>
                  <t>Revoke [RFC5504] from this document.</t>
                  <t>Upgrade some references from I-Ds to RFC.</t>
               </list>
            </t>
         </section>
         <section
            title="draft-ietf-eai-rfc5335bis-01">
            <t>
               <list
                  style="numbers">
                  <t>Author name revised.</t>
               </list>
            </t>
         </section>

         <section
            title="draft-ietf-eai-rfc5335bis-02">
            <t>
               <list
                  style="numbers">
                  <t>ABNF revised.</t>
               </list>
            </t>
         </section>


         <section
            title="draft-ietf-eai-rfc5335bis-03">
            <t>
               <list
                  style="numbers">
                  <t>Fix typos </t>
                  <t>ABNF revised </t>
                  <t>Improve sentence</t>

               </list>
            </t>
         </section>

         <section
            title="draft-ietf-eai-rfc5335bis-04">
            <t>
               <list
                  style="numbers">
                  <t>improve sentences and ABNF revised based on AD and
                     Co-chairs </t>
               </list>
            </t>
         </section>

         <section
            title="draft-ietf-eai-rfc5335bis-05">
            <t>
               <list
                  style="numbers">
                  <t>ABNF revised in <xref
                        target="change_addr_spec"/> based on AD comments </t>
               </list>
            </t>
         </section>


         <section
            title="draft-ietf-eai-rfc5335bis-06">
            <t>
               <list
                  style="numbers">
                  <t>ABNF revised </t>
                  <t>improve <xref
                        target="IANA"/>
                  </t>
               </list>
            </t>
         </section>
      </section>
-->
   </middle>

   <back>
      <references
         title="Normative References">
         <!-- SMTP Service Extension for 8bit-MIMEtransport  -->
         <!-- ietf-eai-smtpext became RFC 5336 --> &RFC2119;
         <!--&RFC5321;--> &RFC5322;
         <!-- UTF-8 --> &RFC3629;
         <!--&I-D.eai-frmwrk-4952bis;
         &I-D.eai-rfc5336bis; &I-D.eai-5378bis;
         &I-D.eai-rfc5721bis;-->
         &RFC5198; &RFC5234; <reference
            anchor="ASCII">
            <front>
               <title>Coded Character Set -- 7-bit American Standard Code for
                  Information Interchange</title>
               <author
                  fullname="American National Standards Institute"/>
               <date
                  year="1986"/>
            </front>
            <seriesInfo
               name="ANSI"
               value="X3.4"/>
         </reference>
         <reference
            anchor="NFC"
            target="http://www.unicode.org/reports/tr15/">
            <front>
               <title>Unicode Standard Annex #15: Unicode Normalization
                  Forms</title>
               <author
                  fullname="Mark Davis"
                  initials="M."
                  surname="Davis"/>
               <author
                  fullname="Ken Whistler"
                  initials="K."
                  surname="Whistler"/>
               <date
                  day="17"
                  month="September"
                  year="2010"/>
            </front>
         </reference>
         <!--<reference
            anchor="I-D.eai-5378bis">

            <front>
               <title>IMAP Support for UTF-8</title>

               <author
                  fullname="Pete Resnick"
                  initials="P"
                  surname="Resnick">
                  <organization/>
               </author>

               <author
                  fullname="Chris Newman"
                  initials="C"
                  surname="Newman">
                  <organization/>
               </author>

               <author
                  fullname="Sean Shen"
                  initials="S"
                  surname="Shen">
                  <organization/>
               </author>
               <date
                  day="8"
                  month="November"
                  year="2010"/>

               <abstract>

                  <t> This specification extends the Internet Message Access
                     Protocol version 4rev1 (IMAP4rev1) to support UTF-8
                     encoded international characters in user names, mail
                     addresses and message headers. </t>
               </abstract>
            </front>
            <seriesInfo
               name="Internet-Draft"
               value="draft-ietf-eai-5378bis-00"/>
            <format
               target="http://www.ietf.org/internet-drafts/draft-ietf-eai-5378bis-00.txt"
               type="TXT"/>
         </reference>
-->
         <!--         <reference
            anchor="I-D.eai-rfc5721bis">

            <front>
               <title>POP3 Support for UTF-8</title>

               <author
                  fullname="Randall Gellens"
                  initials="R"
                  surname="Gellens">
                  <organization/>
               </author>

               <author
                  fullname="Chris Newman"
                  initials="C"
                  surname="Newman">
                  <organization/>
               </author>

               <author
                  fullname="Jiankang Yao"
                  initials="J"
                  surname="Yao">
                  <organization/>
               </author>

               <author
                  fullname="Kazunori Fujiwara"
                  initials="K"
                  surname="Fujiwara">
                  <organization/>
               </author>
               <date
                  day="27"
                  month="September"
                  year="2010"/>

               <abstract>

                  <t> This specification extends the Post Office Protocol
                     version 3 (POP3) to support un-encoded international
                     characters in user names, passwords, mail addresses,
                     message headers, and protocol-level textual error
                     strings. </t>
               </abstract>
            </front>
            <seriesInfo
               name="Internet-Draft"
               value="draft-ietf-eai-rfc5721bis-00"/>
            <format
               target="http://www.ietf.org/internet-drafts/draft-ietf-eai-rfc5721bis-00.txt"
               type="TXT"/>
         </reference>
-->
         <!-- <reference
            anchor="I-D.eai-rfc5336bis">

            <front>
               <title>SMTP Extension for Internationalized Email
                  Address</title>

               <author
                  fullname="Jiankang Yao"
                  initials="J"
                  surname="Yao">
                  <organization/>
               </author>

               <author
                  fullname="Wei MAO"
                  initials="W"
                  surname="MAO">
                  <organization/>
               </author>
               <date
                  day="3"
                  month="December"
                  year="2010"/>

               <abstract>

                  <t> This document specifies an SMTP extension for transport
                     and delivery of email messages with internationalized
                     email addresses or header information. This document
                     updates some syntax rules defined in RFC 5321 and RFC
                     5322. </t>
               </abstract>
            </front>
            <seriesInfo
               name="Internet-Draft"
               value="draft-ietf-eai-rfc5336bis-07"/>
            <format
               target="http://www.ietf.org/internet-drafts/draft-ietf-eai-rfc5336bis-07.txt"
               type="TXT"/>
         </reference>
-->
         <reference
            anchor="I-D.eai-frmwrk-4952bis">
            <front>
               <title>Overview and Framework for Internationalized
                  Email</title>
               <author
                  fullname="John Klensin"
                  initials="J"
                  surname="Klensin">
                  <organization/>
               </author>
               <author
                  fullname="YangWoo Ko"
                  initials="Y"
                  surname="Ko">
                  <organization/>
               </author>
               <date
                  day="27"
                  month="September"
                  year="2010"/>
               <abstract>
                  <t> Full use of electronic mail throughout the world
                     requires that (subject to other constraints) people be
                     able to use close variations on their own names (written
                     correctly in their own languages and scripts) as mailbox
                     names in email addresses. This document introduces a
                     series of specifications that define mechanisms and
                     protocol extensions needed to fully support
                     internationalized email addresses. These changes include
                     an SMTP extension and extension of email header syntax to
                     accommodate UTF-8 data. The document set also includes
                     discussion of key assumptions and issues in deploying
                     fully internationalized email. This document is an update
                     of RFC 4952; it reflects additional issues identified
                     since that document was published. </t>
               </abstract>
            </front>
            <seriesInfo
               name="Internet-Draft"
               value="draft-ietf-eai-frmwrk-4952bis-10"/>
            <format
               target="http://www.ietf.org/internet-drafts/draft-ietf-eai-frmwrk-4952bis-10.txt"
               type="TXT"/>
         </reference>

         <reference
            anchor="RFC5598">
            <front>
               <title>Internet Mail Architecture</title>
               <author
                  fullname="D. Crocker"
                  initials="D."
                  surname="Crocker"/>
               <date
                  month="July"
                  year="2009"/>
            </front>
            <seriesInfo
               name="RFC"
               value="5598"/>
         </reference>

         <reference
            anchor="Latin">
            <front>
               <title>C0 Controls and Basic Latin</title>
               <author
                  fullname="Unicode Consortium"
                  surname="Unicode Consortium"/>
               <date
                  year="2010"/>
            </front>

            <seriesInfo
               name="http://unicode.org"
               value="/charts/PDF/U0000.pdf"/>
         </reference>

         <reference
            anchor="Unicode">
            <front>
               <title>Unicode 6.0 Character Code Charts</title>
               <author
                  fullname="Unicode Consortium"
                  surname="Unicode Consortium"/>
               <date
                  year="2010"/>
            </front>
            <seriesInfo
               name="http://unicode.org"
               value="/charts/"/>
         </reference>


      </references>

      <references
         title="Informative References">
         <!-- 8bitmime -->
         <!--&RFC1652;-->
         <!-- MIME (parts 1, 2, 3) --> &RFC2045; &RFC2046; <!--&RFC2047;-->
         <!-- openPGP --> &RFC3156; <!-- PKIX --> &RFC5280;
         <!-- &RFC5504;  given up -->
      </references>
      <section
         title="Changes to support UTF-8">
         <t>This section provides a basic audit of the places in a message
            that now can permit UTF-8 rather than being restricted to ASCII,
            based on the changes to underlying ABNF. The audit ignores rule
            for "obsolete" constructs in RFC 5322. (This is a first cut and
            the list is likely incomplete):<list
               style="hanging">
               <t
                  hangText="VCHAR:  ">quoted-pair, unstructured</t>
               <t>&gt; ccontent, qcontent </t>
               <t>&gt; comment, quoted-string </t>
               <t>&gt; word, local-part </t>
               <t>&gt; phrase </t>
               <t>&gt; display-name, keywords </t>

               <t
                  hangText="ctext:  ">ccontent &gt; comment</t>

               <t
                  hangText="atext:  ">atom, dot-atom-text</t>

               <t
                  hangText="qtext:  ">qcontent &gt; quoted-string</t>

            </list>
         </t>
      </section>

      <!--

VCHAR   =/  UTF8-non-ascii

ctext   =/  UTF8-non-ascii

atext   =/  UTF8-non-ascii

qtext   =/  UTF8-non-ascii

-->


   </back>
</rfc>
