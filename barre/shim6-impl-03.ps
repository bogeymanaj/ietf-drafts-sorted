%!PS-Adobe-3.0
%%BoundingBox: 18 36 577 806
%%Title: Enscript Output
%%Creator: GNU enscript 1.6.4
%%CreationDate: Thu Sep 24 13:59:16 2009
%%Orientation: Landscape
%%Pages: (atend)
%%DocumentMedia: A4 595 842 0 () ()
%%DocumentNeededResources: (atend)
%%EndComments
%%BeginProlog
%%BeginResource: procset Enscript-Prolog 1.6 4
%
% Procedures.
%

/_S {	% save current state
  /_s save def
} def
/_R {	% restore from saved state
  _s restore
} def

/S {	% showpage protecting gstate
  gsave
  showpage
  grestore
} bind def

/MF {	% fontname newfontname -> -	make a new encoded font
  /newfontname exch def
  /fontname exch def

  /fontdict fontname findfont def
  /newfont fontdict maxlength dict def

  fontdict {
    exch
    dup /FID eq {
      % skip FID pair
      pop pop
    } {
      % copy to the new font dictionary
      exch newfont 3 1 roll put
    } ifelse
  } forall

  newfont /FontName newfontname put

  % insert only valid encoding vectors
  encoding_vector length 256 eq {
    newfont /Encoding encoding_vector put
  } if

  newfontname newfont definefont pop
} def

/MF_PS { % fontname newfontname -> -	make a new font preserving its enc
  /newfontname exch def
  /fontname exch def

  /fontdict fontname findfont def
  /newfont fontdict maxlength dict def

  fontdict {
    exch
    dup /FID eq {
      % skip FID pair
      pop pop
    } {
      % copy to the new font dictionary
      exch newfont 3 1 roll put
    } ifelse
  } forall

  newfont /FontName newfontname put

  newfontname newfont definefont pop
} def

/SF { % fontname width height -> -	set a new font
  /height exch def
  /width exch def

  findfont
  [width 0 0 height 0 0] makefont setfont
} def

/SUF { % fontname width height -> -	set a new user font
  /height exch def
  /width exch def

  /F-gs-user-font MF
  /F-gs-user-font width height SF
} def

/SUF_PS { % fontname width height -> -	set a new user font preserving its enc
  /height exch def
  /width exch def

  /F-gs-user-font MF_PS
  /F-gs-user-font width height SF
} def

/M {moveto} bind def
/s {show} bind def

/Box {	% x y w h -> -			define box path
  /d_h exch def /d_w exch def /d_y exch def /d_x exch def
  d_x d_y  moveto
  d_w 0 rlineto
  0 d_h rlineto
  d_w neg 0 rlineto
  closepath
} def

/bgs {	% x y height blskip gray str -> -	show string with bg color
  /str exch def
  /gray exch def
  /blskip exch def
  /height exch def
  /y exch def
  /x exch def

  gsave
    x y blskip sub str stringwidth pop height Box
    gray setgray
    fill
  grestore
  x y M str s
} def

/bgcs { % x y height blskip red green blue str -> -  show string with bg color
  /str exch def
  /blue exch def
  /green exch def
  /red exch def
  /blskip exch def
  /height exch def
  /y exch def
  /x exch def

  gsave
    x y blskip sub str stringwidth pop height Box
    red green blue setrgbcolor
    fill
  grestore
  x y M str s
} def

% Highlight bars.
/highlight_bars {	% nlines lineheight output_y_margin gray -> -
  gsave
    setgray
    /ymarg exch def
    /lineheight exch def
    /nlines exch def

    % This 2 is just a magic number to sync highlight lines to text.
    0 d_header_y ymarg sub 2 sub translate

    /cw d_output_w cols div def
    /nrows d_output_h ymarg 2 mul sub lineheight div cvi def

    % for each column
    0 1 cols 1 sub {
      cw mul /xp exch def

      % for each rows
      0 1 nrows 1 sub {
        /rn exch def
        rn lineheight mul neg /yp exch def
        rn nlines idiv 2 mod 0 eq {
	  % Draw highlight bar.  4 is just a magic indentation.
	  xp 4 add yp cw 8 sub lineheight neg Box fill
	} if
      } for
    } for

  grestore
} def

% Line highlight bar.
/line_highlight {	% x y width height gray -> -
  gsave
    /gray exch def
    Box gray setgray fill
  grestore
} def

% Column separator lines.
/column_lines {
  gsave
    .1 setlinewidth
    0 d_footer_h translate
    /cw d_output_w cols div def
    1 1 cols 1 sub {
      cw mul 0 moveto
      0 d_output_h rlineto stroke
    } for
  grestore
} def

% Column borders.
/column_borders {
  gsave
    .1 setlinewidth
    0 d_footer_h moveto
    0 d_output_h rlineto
    d_output_w 0 rlineto
    0 d_output_h neg rlineto
    closepath stroke
  grestore
} def

% Do the actual underlay drawing
/draw_underlay {
  ul_style 0 eq {
    ul_str true charpath stroke
  } {
    ul_str show
  } ifelse
} def

% Underlay
/underlay {	% - -> -
  gsave
    0 d_page_h translate
    d_page_h neg d_page_w atan rotate

    ul_gray setgray
    ul_font setfont
    /dw d_page_h dup mul d_page_w dup mul add sqrt def
    ul_str stringwidth pop dw exch sub 2 div ul_h_ptsize -2 div moveto
    draw_underlay
  grestore
} def

/user_underlay {	% - -> -
  gsave
    ul_x ul_y translate
    ul_angle rotate
    ul_gray setgray
    ul_font setfont
    0 0 ul_h_ptsize 2 div sub moveto
    draw_underlay
  grestore
} def

% Page prefeed
/page_prefeed {		% bool -> -
  statusdict /prefeed known {
    statusdict exch /prefeed exch put
  } {
    pop
  } ifelse
} def

% Wrapped line markers
/wrapped_line_mark {	% x y charwith charheight type -> -
  /type exch def
  /h exch def
  /w exch def
  /y exch def
  /x exch def

  type 2 eq {
    % Black boxes (like TeX does)
    gsave
      0 setlinewidth
      x w 4 div add y M
      0 h rlineto w 2 div 0 rlineto 0 h neg rlineto
      closepath fill
    grestore
  } {
    type 3 eq {
      % Small arrows
      gsave
        .2 setlinewidth
        x w 2 div add y h 2 div add M
        w 4 div 0 rlineto
        x w 4 div add y lineto stroke

        x w 4 div add w 8 div add y h 4 div add M
        x w 4 div add y lineto
	w 4 div h 8 div rlineto stroke
      grestore
    } {
      % do nothing
    } ifelse
  } ifelse
} def

% EPSF import.

/BeginEPSF {
  /b4_Inc_state save def    		% Save state for cleanup
  /dict_count countdictstack def	% Count objects on dict stack
  /op_count count 1 sub def		% Count objects on operand stack
  userdict begin
  /showpage { } def
  0 setgray 0 setlinecap
  1 setlinewidth 0 setlinejoin
  10 setmiterlimit [ ] 0 setdash newpath
  /languagelevel where {
    pop languagelevel
    1 ne {
      false setstrokeadjust false setoverprint
    } if
  } if
} bind def

/EndEPSF {
  count op_count sub { pos } repeat	% Clean up stacks
  countdictstack dict_count sub { end } repeat
  b4_Inc_state restore
} bind def

% Check PostScript language level.
/languagelevel where {
  pop /gs_languagelevel languagelevel def
} {
  /gs_languagelevel 1 def
} ifelse
%%EndResource
%%BeginResource: procset Enscript-Encoding-88591 1.6 4
/encoding_vector [
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/space        	/exclam       	/quotedbl     	/numbersign   	
/dollar       	/percent      	/ampersand    	/quoteright   	
/parenleft    	/parenright   	/asterisk     	/plus         	
/comma        	/hyphen       	/period       	/slash        	
/zero         	/one          	/two          	/three        	
/four         	/five         	/six          	/seven        	
/eight        	/nine         	/colon        	/semicolon    	
/less         	/equal        	/greater      	/question     	
/at           	/A            	/B            	/C            	
/D            	/E            	/F            	/G            	
/H            	/I            	/J            	/K            	
/L            	/M            	/N            	/O            	
/P            	/Q            	/R            	/S            	
/T            	/U            	/V            	/W            	
/X            	/Y            	/Z            	/bracketleft  	
/backslash    	/bracketright 	/asciicircum  	/underscore   	
/quoteleft    	/a            	/b            	/c            	
/d            	/e            	/f            	/g            	
/h            	/i            	/j            	/k            	
/l            	/m            	/n            	/o            	
/p            	/q            	/r            	/s            	
/t            	/u            	/v            	/w            	
/x            	/y            	/z            	/braceleft    	
/bar          	/braceright   	/tilde        	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/.notdef      	/.notdef      	/.notdef      	/.notdef      	
/space        	/exclamdown   	/cent         	/sterling     	
/currency     	/yen          	/brokenbar    	/section      	
/dieresis     	/copyright    	/ordfeminine  	/guillemotleft	
/logicalnot   	/hyphen       	/registered   	/macron       	
/degree       	/plusminus    	/twosuperior  	/threesuperior	
/acute        	/mu           	/paragraph    	/bullet       	
/cedilla      	/onesuperior  	/ordmasculine 	/guillemotright	
/onequarter   	/onehalf      	/threequarters	/questiondown 	
/Agrave       	/Aacute       	/Acircumflex  	/Atilde       	
/Adieresis    	/Aring        	/AE           	/Ccedilla     	
/Egrave       	/Eacute       	/Ecircumflex  	/Edieresis    	
/Igrave       	/Iacute       	/Icircumflex  	/Idieresis    	
/Eth          	/Ntilde       	/Ograve       	/Oacute       	
/Ocircumflex  	/Otilde       	/Odieresis    	/multiply     	
/Oslash       	/Ugrave       	/Uacute       	/Ucircumflex  	
/Udieresis    	/Yacute       	/Thorn        	/germandbls   	
/agrave       	/aacute       	/acircumflex  	/atilde       	
/adieresis    	/aring        	/ae           	/ccedilla     	
/egrave       	/eacute       	/ecircumflex  	/edieresis    	
/igrave       	/iacute       	/icircumflex  	/idieresis    	
/eth          	/ntilde       	/ograve       	/oacute       	
/ocircumflex  	/otilde       	/odieresis    	/divide       	
/oslash       	/ugrave       	/uacute       	/ucircumflex  	
/udieresis    	/yacute       	/thorn        	/ydieresis    	
] def
%%EndResource
%%EndProlog
%%BeginSetup
%%IncludeResource: font Courier-Bold
%%IncludeResource: font Courier
/HFpt_w 10 def
/HFpt_h 10 def
/Courier-Bold /HF-gs-font MF
/HF /HF-gs-font findfont [HFpt_w 0 0 HFpt_h 0 0] makefont def
/Courier /F-gs-font MF
/F-gs-font 7 7 SF
/#copies 1 def
% Pagedevice definitions:
gs_languagelevel 1 gt {
  <<
    /PageSize [595 842] 
  >> setpagedevice
} if
%%BeginResource: procset Enscript-Header-simple 1.6 4

/do_header {	% print default simple header
  gsave
    d_header_x d_header_y HFpt_h 3 div add translate

    HF setfont
    user_header_p {
      5 0 moveto user_header_left_str show

      d_header_w user_header_center_str stringwidth pop sub 2 div
      0 moveto user_header_center_str show

      d_header_w user_header_right_str stringwidth pop sub 5 sub
      0 moveto user_header_right_str show
    } {
      5 0 moveto fname show
      45 0 rmoveto fmodstr show
      45 0 rmoveto pagenumstr show
    } ifelse

  grestore
} def
%%EndResource
/d_page_w 770 def
/d_page_h 559 def
/d_header_x 0 def
/d_header_y 544 def
/d_header_w 770 def
/d_header_h 15 def
/d_footer_x 0 def
/d_footer_y 0 def
/d_footer_w 770 def
/d_footer_h 0 def
/d_output_w 770 def
/d_output_h 544 def
/cols 2 def
%%EndSetup
%%Page: (1) 1
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 1 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (1) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 510 M
(Network Working Group                                           S. Barre) s
5 502 M
(Internet-Draft                                            O. Bonaventure) s
5 494 M
(Expires: March 28, 2010                               UCLouvain, Belgium) s
5 486 M
(                                                      September 24, 2009) s
5 462 M
(                 Shim6 Implementation Report : LinShim6) s
5 454 M
(                       draft-barre-shim6-impl-03) s
5 438 M
(Status of this Memo) s
5 422 M
(   This Internet-Draft is submitted to IETF in full conformance with the) s
5 414 M
(   provisions of BCP 78 and BCP 79.) s
5 398 M
(   Internet-Drafts are working documents of the Internet Engineering) s
5 390 M
(   Task Force \(IETF\), its areas, and its working groups.  Note that) s
5 382 M
(   other groups may also distribute working documents as Internet-) s
5 374 M
(   Drafts.) s
5 358 M
(   Internet-Drafts are draft documents valid for a maximum of six months) s
5 350 M
(   and may be updated, replaced, or obsoleted by other documents at any) s
5 342 M
(   time.  It is inappropriate to use Internet-Drafts as reference) s
5 334 M
(   material or to cite them other than as "work in progress.") s
5 318 M
(   The list of current Internet-Drafts can be accessed at) s
5 310 M
(   http://www.ietf.org/ietf/1id-abstracts.txt.) s
5 294 M
(   The list of Internet-Draft Shadow Directories can be accessed at) s
5 286 M
(   http://www.ietf.org/shadow.html.) s
5 270 M
(   This Internet-Draft will expire on March 28, 2010.) s
5 254 M
(Copyright Notice) s
5 238 M
(   Copyright \(c\) 2009 IETF Trust and the persons identified as the) s
5 230 M
(   document authors.  All rights reserved.) s
5 214 M
(   This document is subject to BCP 78 and the IETF Trust's Legal) s
5 206 M
(   Provisions Relating to IETF Documents in effect on the date of) s
5 198 M
(   publication of this document \(http://trustee.ietf.org/license-info\).) s
5 190 M
(   Please review these documents carefully, as they describe your rights) s
5 182 M
(   and restrictions with respect to this document.) s
5 102 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 1]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(Abstract) s
390 486 M
(   LinShim6 is an implementation of the Shim6 and REAP protocols, on the) s
390 478 M
(   Linux platform.  This draft provides a description of the) s
390 470 M
(   architecture and describes the current state of our implementation.) s
390 462 M
(   The level of support of each protocol feature is detailed.  Protocol) s
390 454 M
(   conformance is evaluated against the main drafts.) s
390 430 M
(Table of Contents) s
390 414 M
(   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3) s
390 406 M
(   2.  General architecture . . . . . . . . . . . . . . . . . . . . .  4) s
390 398 M
(     2.1.  Kernel patch . . . . . . . . . . . . . . . . . . . . . . .  4) s
390 390 M
(     2.2.  LinShim6 daemon  . . . . . . . . . . . . . . . . . . . . .  5) s
390 382 M
(       2.2.1.  Random number generation . . . . . . . . . . . . . . .  5) s
390 374 M
(       2.2.2.  HBA/CGA support  . . . . . . . . . . . . . . . . . . .  5) s
390 366 M
(     2.3.  Locator updates  . . . . . . . . . . . . . . . . . . . . .  6) s
390 358 M
(     2.4.  Context removal  . . . . . . . . . . . . . . . . . . . . .  6) s
390 350 M
(   3.  RFC 2119 evaluation  . . . . . . . . . . . . . . . . . . . . .  8) s
390 342 M
(     3.1.  Checks common to all control messages  . . . . . . . . . .  9) s
390 334 M
(     3.2.  I1 Message . . . . . . . . . . . . . . . . . . . . . . . .  9) s
390 326 M
(     3.3.  R1 Message . . . . . . . . . . . . . . . . . . . . . . . . 10) s
390 318 M
(     3.4.  I2 Message . . . . . . . . . . . . . . . . . . . . . . . . 10) s
390 310 M
(     3.5.  R2 Message . . . . . . . . . . . . . . . . . . . . . . . . 11) s
390 302 M
(     3.6.  R1bis, I2bis . . . . . . . . . . . . . . . . . . . . . . . 12) s
390 294 M
(     3.7.  Update Request\(UR\)/Acknowledgement\(UA\) messages  . . . . . 12) s
390 286 M
(     3.8.  Keepalive and Probe Messages . . . . . . . . . . . . . . . 13) s
390 278 M
(     3.9.  Keepalive Timeout Option . . . . . . . . . . . . . . . . . 13) s
390 270 M
(     3.10. Error messages . . . . . . . . . . . . . . . . . . . . . . 14) s
390 262 M
(     3.11. Message Options  . . . . . . . . . . . . . . . . . . . . . 14) s
390 254 M
(     3.12. Payload data . . . . . . . . . . . . . . . . . . . . . . . 15) s
390 246 M
(     3.13. General requirements of the Shim6 draft  . . . . . . . . . 15) s
390 238 M
(     3.14. General requirements of the REAP draft . . . . . . . . . . 16) s
390 230 M
(   4.  Protocol conformance by feature  . . . . . . . . . . . . . . . 18) s
390 222 M
(   5.  Conclusion and further work  . . . . . . . . . . . . . . . . . 19) s
390 214 M
(   6.  Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . . 20) s
390 206 M
(   7.  References . . . . . . . . . . . . . . . . . . . . . . . . . . 21) s
390 198 M
(   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 22) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 2]) s
_R
S
%%Page: (2) 2
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 2 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (2) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(1.  Introduction) s
5 486 M
(   The Shim6 protocol [RFC5533] has been designed to add multihoming) s
5 478 M
(   capabilities to IPv6, while avoiding the drawbacks of current IPv4) s
5 470 M
(   multihoming practice \(prefix announcements in BGP\), and giving more) s
5 462 M
(   control to the end host \(through locator selection\).) s
5 446 M
(   Together with the Shim6 protocol, the working group has designed a) s
5 438 M
(   failure detection mechanism, called REAP [RFC5534], that allows hosts) s
5 430 M
(   to detect and recover from failures, thanks to a combination of) s
5 422 M
(   traffic monitoring and active probing.) s
5 406 M
(   Implementing such new protocols is crucial to allow tracking errors) s
5 398 M
(   or weaknesses in the overall design, as well as evaluating protocol) s
5 390 M
(   behaviour in the real world.  We developped an implementation of) s
5 382 M
(   Shim6 and REAP, available from <http://inl.info.ucl.ac.be/LinShim6>.) s
5 374 M
(   LinShim6 has been used to evaluate the performance of REAP path) s
5 366 M
(   exploration [BARRE07].) s
5 350 M
(   This draft is aimed at describing the challenges of a proper) s
5 342 M
(   integration of Shim6 in a protocol stack while preserving its) s
5 334 M
(   efficiency.  LinShim6 supports the base Shim6 protocol \(negotiation) s
5 326 M
(   and address rewriting\) as well as failure detection and recovery) s
5 318 M
(   \(REAP\).  To our knowledge LinShim6 is also the first publicly) s
5 310 M
(   available implementation that supports both the HBA and CGA) s
5 302 M
(   mechanisms for securing the locator set exchange \(the CGA/HBA code is) s
5 294 M
(   derived mostly from the DoCoMo SEND project [1]\).) s
5 278 M
(   In this draft, we present a detailed report of the supported parts of) s
5 270 M
(   the protocol, in terms of the terminology defined in section 2 of) s
5 262 M
(   [RFC5533].  Some non critical features for the current application of) s
5 254 M
(   LinShim6 have not been implemented yet.  They will be added as soon) s
5 246 M
(   as a need for them arises.  For instance, the Forked Instance) s
5 238 M
(   Identifier is only useful if a socket API is implemented \(such as the) s
5 230 M
(   API defined in [I-D.ietf-shim6-multihome-shim-api]\).  The Locator) s
5 222 M
(   Preference Option may only be used if the corresponding tuning) s
5 214 M
(   capability is provided, either by the user or by an automated) s
5 206 M
(   technique.) s
5 190 M
(   Other features will be supported in a future version of the) s
5 182 M
(   implementation.  These are detailed in Section 4.) s
5 166 M
(   This draft describes version 0.9 of LinShim6.) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 3]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(2.  General architecture) s
390 486 M
(   The LinShim6 implementation is composed of two parts.  First, a) s
390 478 M
(   kernel patch adds support for shim6 negotiation trigger, address) s
390 470 M
(   rewriting and failure detection.  Second, a daemon is responsible for) s
390 462 M
(   the management of the Shim6 control plane \(negotiation, path) s
390 454 M
(   exploration\).  The kernel communicates with the user space daemon) s
390 446 M
(   through the Netlink interface [RFC3549].) s
390 430 M
(   Hereafter we briefly describe the kernel and user level part of) s
390 422 M
(   LinShim6.  A more extensive description can be found in [BARRE07b] or) s
390 414 M
(   [BARRE08].) s
390 398 M
(2.1.  Kernel patch) s
390 382 M
(   The default negotiation trigger makes use of the NF_IP6_LOCAL_IN and) s
390 374 M
(   NF_IP6_LOCAL_OUT netfilter hooks to listen to the packets travelling) s
390 366 M
(   through the networking stack.  A Shim6 negotiation is triggered by) s
390 358 M
(   default when either 2 KB of data have been seen for a given address) s
390 350 M
(   pair or the flow exists for one minute.  Those values have been) s
390 342 M
(   chosen through observation of netflow traces, showing that more than) s
390 334 M
(   80% of the observed traffic last less than 1 minute, and also 80% is) s
390 326 M
(   less than 2 KB in size.  This default heuristic thus appeared as a) s
390 318 M
(   reasonable discriminator to avoid starting a Shim6 negotiation when) s
390 310 M
(   it is not needed.  In some cases \(e.g. heavily loaded servers\), one) s
390 302 M
(   may want to never trigger a Shim6 context establishment, except if it) s
390 294 M
(   is explicitly requested by the peer.  This is possible by simply not) s
390 286 M
(   loading the heuristic module.  One can also define its own heuristic,) s
390 278 M
(   by designing a customized module.) s
390 262 M
(   Address rewriting is implemented as an extension to the XFRM) s
390 254 M
(   framework, originally designed for IPsec [KANDA04].  The XFRM) s
390 246 M
(   framework allows for dynamically adding a new sublayer in the) s
390 238 M
(   Networking stack for some flows, according to a policy.  Examples of) s
390 230 M
(   already defined sublayers are the AH sublayer \(Authentication Header\)) s
390 222 M
(   or the ESP sublayer \(Encapsulating Security Payload\).  Similarly, we) s
390 214 M
(   define a new sublayer for Shim6.  The policies responsible for) s
390 206 M
(   directing packets to this new module are communicated from the daemon) s
390 198 M
(   to the kernel through Netlink, when a change in the locators is) s
390 190 M
(   needed or a new Shim6 context is created.  For outgoing packets, the) s
390 182 M
(   policy takes the form of a matching rule with the ULIDs \(Upper Layer) s
390 174 M
(   IDentifiers, defined in [RFC5533]\).  For incoming packets that do not) s
390 166 M
(   have the Shim6 extension header, the same kind of matching rule is) s
390 158 M
(   used.  We also defined a matching rule based on the context tag, in) s
390 150 M
(   order to be able to demultiplex tagged incoming packets.) s
390 134 M
(   Failure detection is performed inside the kernel for efficiency) s
390 126 M
(   reasons: a timer must be started or stopped for each incoming or) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 4]) s
_R
S
%%Page: (3) 3
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 3 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (3) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(   outgoing packet.  We maintain REAP failure detection timers inside) s
5 494 M
(   the XFRM states, so that the daemon is notified \(through Netlink\)) s
5 486 M
(   when a keepalive must be sent or an exploration is to be started.) s
5 470 M
(2.2.  LinShim6 daemon) s
5 454 M
(   The daemon continuously listens to three types of events.  First,) s
5 446 M
(   Shim6 and REAP control messages are received through a raw socket.) s
5 438 M
(   Second, Netlink messages provide information from the kernel, for) s
5 430 M
(   example whether a context must be created, a keepalive must be sent) s
5 422 M
(   or an exploration must be started.  Finally, messages can be received) s
5 414 M
(   through a pipe where the other threads may write commands.  Four) s
5 406 M
(   threads are currently defined:) s
5 390 M
(   o  Main thread: Maintains all the critical states.) s
5 374 M
(   o  XFRM: Listens to the XFRM events from the kernel.  Currently only) s
5 366 M
(      the state expiry event is used.  It is generated when a kernel) s
5 358 M
(      context has seen no traffic during more than 10 minutes.  The) s
5 350 M
(      result is that the daemon deletes the corresponding association.) s
5 334 M
(   o  Timer: It maintains a timer queue and wakes up when any timer) s
5 326 M
(      expires.  On expiration of any timer, it requests the main thread) s
5 318 M
(      to run the corresponding handling function.) s
5 302 M
(   o  Information server: A simple telnet server that provides a) s
5 294 M
(      convenient interface to the daemon.  The server can be accessed) s
5 286 M
(      with the shim6c tool.) s
5 270 M
(2.2.1.  Random number generation) s
5 254 M
(   We generate random numbers based on the Linux random\(\) function, with) s
5 246 M
(   a seed taken from /dev/random when the daemon starts, and every 1000) s
5 238 M
(   generation.) s
5 222 M
(2.2.2.  HBA/CGA support) s
5 206 M
(   The user is able to set HBA and CGA parameters thanks to a) s
5 198 M
(   configuration file.  A tool \(cgatool\), derived from the DoCoMo SEND) s
5 190 M
(   project, allows for manual generation of CGA keys, CGA addresses and) s
5 182 M
(   HBA addresses.  Four types of addresses can coexist in an end-system:) s
5 174 M
(   unsecured, HBA, CGA and CGA-compatible HBA.  It is up to the) s
5 166 M
(   applications to decide which address is used as ULID for a given) s
5 158 M
(   communication.  If the application chooses the unspecified source) s
5 150 M
(   address, then the kernel applies RFC3484[RFC3484] rules to pick a) s
5 142 M
(   suitable source address from the available set.  When performing the) s
5 134 M
(   locator set exchange, LinShim6 decides what locators to use in the) s
5 126 M
(   local locator set based on the ULID type:) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 5]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(   o  Unsecured address: the local ULID is neither a CGA nor an HBA.) s
390 494 M
(      LinShim6 decides that the locator set is made of only the ULID,) s
390 486 M
(      because it would be impossible for the peer to check the validity) s
390 478 M
(      of the other locators.) s
390 462 M
(   o  HBA address: the local ULID is an HBA \(not CGA-compatible\):) s
390 454 M
(      LinShim6 sends all the addresses that are in the same HBA set and) s
390 446 M
(      are currently available in the system.  For example if an HBA set) s
390 438 M
(      is configured to gather four prefixes, but the host only receives) s
390 430 M
(      Router Advertisements for two of them, only the corresponding two) s
390 422 M
(      addresses are announced to the peer.  If later other addresses) s
390 414 M
(      become reachable, they are announced through an Update Request.) s
390 398 M
(   o  CGA address: since a signature is used to authenticate a locator) s
390 390 M
(      set, any locator can be put in the set.  LinShim6 behaviour is) s
390 382 M
(      then to advertise all available locators in the system.) s
390 366 M
(   o  CGA-compatible HBA address: LinShim6 also sends all available) s
390 358 M
(      locators to the peer.  The only difference with pure CGA addresses) s
390 350 M
(      is that the subset of addresses belonging to the same HBA set as) s
390 342 M
(      the ULID are verified with HBA rather than included in the) s
390 334 M
(      signature, thus leading to a faster verification process.) s
390 318 M
(2.3.  Locator updates) s
390 302 M
(   During the lifetime of a Shim6 context, locators may appear or) s
390 294 M
(   disappear.  If a new locator becomes available in the system, all) s
390 286 M
(   peers are updated \(except if the new address cannot be added to some) s
390 278 M
(   of the contexts, according to the rules described in Section 2.2.2\).) s
390 270 M
(   As required by [RFC5533], the new locator starts being actually part) s
390 262 M
(   of a Shim6 context only when the new locator set has been aknowledged) s
390 254 M
(   by the peer.) s
390 238 M
(   On the other hand, when a locator disappears, it is immediately) s
390 230 M
(   removed from all contexts and a locator update is sent to the peer.) s
390 222 M
(   It does not make sense to wait for the acknowledgement in that case,) s
390 214 M
(   since the locator is not reachable anymore.  Moreover, if the removed) s
390 206 M
(   locator is current for any context \(that is, actually used for) s
390 198 M
(   sending packets\), a REAP path exploration is triggered.) s
390 182 M
(2.4.  Context removal) s
390 166 M
(   As mentioned in the previous section, a context is removed upon) s
390 158 M
(   reception of an XFRM event from the kernel, indicating that no) s
390 150 M
(   traffic has been seen for that context during at least 10 minutes.) s
390 142 M
(   The daemon then cleans up all data related to the expired context,) s
390 134 M
(   both in the daemon and in the kernel.  Shim6 kernel state is also) s
390 126 M
(   cleaned everytime the daemon is started to avoid inconsistency.) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 6]) s
_R
S
%%Page: (4) 4
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 4 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (4) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(   In the future, we will also check if no opened socked is using the) s
5 494 M
(   context before removing it.  This will avoid the current possibility) s
5 486 M
(   that a context gets stalled, if it remains idle during more than 10) s
5 478 M
(   minutes and then tries to send data again.) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 7]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(3.  RFC 2119 evaluation) s
390 486 M
(   In this section we detail the conformance of the LinShim6) s
390 478 M
(   implementation in terms of the RFC2119 [RFC2119] terminology.) s
390 470 M
(   Additionally, we define hereafter the keywords that are used to) s
390 462 M
(   describe the level of support for the different features.) s
390 446 M
(   o  YES: The feature is fully supported.) s
390 430 M
(   o  FEATURE NOT SUPPORTED: if a MUST is followed by "FEATURE NOT) s
390 422 M
(      SUPPORTED", this means that the MUST makes sense only if the) s
390 414 M
(      feature exists.  That is, the implementation is still compliant) s
390 406 M
(      but does not implement the particular feature.  Currently) s
390 398 M
(      unsupported features are:) s
390 382 M
(      *  R1bis: this message is defined to allow the recovery of a) s
390 374 M
(         context, when one endpoint has dropped the context while the) s
390 366 M
(         other endpoint is still using it.  When [RFC5533] specifies to) s
390 358 M
(         send a R1bis message, we currently ignore the message supposed) s
390 350 M
(         to trigger the sending of the R1bis.) s
390 334 M
(      *  Error messages: used to inform the peer about what went wrong.) s
390 318 M
(      *  IPsec: the design of LinShim6 is based on the XFRM architecture) s
390 310 M
(         in the kernel.  The same architecture is used by IPsec, thus a) s
390 302 M
(         small adaptation \(if any\) of LinShim6 should allow it to work) s
390 294 M
(         well together with IPsec.  However, we have not yet tested such) s
390 286 M
(         an interaction.) s
390 270 M
(      *  FII \(Forked Instance Identifier\): the FII is defined in) s
390 262 M
(         [RFC5533] as a way to fork Shim6 contexts, so that several) s
390 254 M
(         contexts may share the same ULID pair, and are distinguished) s
390 246 M
(         thanks to an integer called the FII.  This has interest only if) s
390 238 M
(         a socket API is implemented, so that applications may choose a) s
390 230 M
(         context rather than another to send packets \(which allows) s
390 222 M
(         selecting a different set of locators\).  There is no short term) s
390 214 M
(         plan to support this.) s
390 198 M
(      *  ULID pair option: it is defined to allow performing context) s
390 190 M
(         negotiation with a locator pair that differs from the ULID) s
390 182 M
(         pair.  This may be useful for example if non routable ULIDs are) s
390 174 M
(         used.  There is no short term plan to support this, because) s
390 166 M
(         non-routable ULIDs are not \(yet ?\) deployed in the current) s
390 158 M
(         Internet.) s
390 142 M
(   o  NO: Unsupported optional features are simply followed by NO.) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 8]) s
_R
S
%%Page: (5) 5
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 5 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (5) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(   o  CONFIGURABLE: The feature is supported, but requires manual) s
5 494 M
(      configuration from the user for correct behaviour.) s
5 478 M
(   o  PARTIAL SUPPORT: The feature is partially supported, that is, the) s
5 470 M
(      requirement in verified in some cases, but not all.  In that case) s
5 462 M
(      we point to a section that gives more details on the behaviour.) s
5 446 M
(3.1.  Checks common to all control messages) s
5 430 M
(   A host MUST silently discard any received control message that does) s
5 422 M
(   not statisfy all of the following validity checks:) s
5 406 M
(   o  The Shim header length field is verified against the length of the) s
5 398 M
(      IPv6 packet to make sure that the shim message doesn't claim to) s
5 390 M
(      end past the end of the IPv6 packet: YES \(Checked in the kernel\)) s
5 374 M
(   o  the checksum is correct: YES \(Checked in the kernel\)) s
5 358 M
(   o  Neither the IPv6 destination field nor the IPv6 source field is a) s
5 350 M
(      multicast address nor the unspecified address: YES \(Checked in the) s
5 342 M
(      kernel\)) s
5 326 M
(3.2.  I1 Message) s
5 310 M
(   o  The Reserved1 field MUST be ignored on receipt: YES) s
5 294 M
(   o  The R field MUST be ignored on receipt: YES) s
5 278 M
(   o  When another instance of an existent context with the same ULID) s
5 270 M
(      pair is being created, a Forked Instance Identifier option MUST be) s
5 262 M
(      included to distinguish this new instance from the existent one:) s
5 254 M
(      FEATURE NOT SUPPORTED \(FII\)) s
5 238 M
(   o  The I1 message MUST include the ULID pair: YES \(always in the IPv6) s
5 230 M
(      header\)) s
5 214 M
(   o  A host MUST silently discard any received I1 message that does not) s
5 206 M
(      statisfy all of the following validity checks:) s
5 190 M
(      *  Hdr Ext Len field at least 1: YES) s
5 174 M
(      *  If the ULID pair option is present, the host verifies that the) s
5 166 M
(         locator of the Initiator is included in Ls\(peer\): FEATURE NO) s
5 158 M
(         SUPPORTED \(ULID pair option\)) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                 [Page 9]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(3.3.  R1 Message) s
390 486 M
(   o  The Reserved1 field MUST be ignored on receipt: YES) s
390 470 M
(   o  The Reserved2 field MUST be ignored on receipt: YES) s
390 454 M
(   o  The Responder Validator Option MUST be included: YES) s
390 438 M
(   o  A host MUST silently discard any received R1 message that does not) s
390 430 M
(      statisfy all of the following validity checks:) s
390 414 M
(      *  Hdr Ext Len field at least 1: YES) s
390 398 M
(      *  the host looks for an existing context which matches the) s
390 390 M
(         Initiator Nonce and where the locators are contained in) s
390 382 M
(         Ls\(peer\) and Ls\(local\), respectively.  If no such context is) s
390 374 M
(         found, then the R1 message is silently discarded: YES) s
390 358 M
(      *  If the context found using the above rules is not in I1-SENT) s
390 350 M
(         state, the R1 message is silently discarded: YES) s
390 334 M
(3.4.  I2 Message) s
390 318 M
(   o  The Reserved1 field MUST be ignored on receipt: YES) s
390 302 M
(   o  The R field MUST be ignored on receipt: YES) s
390 286 M
(   o  The Reserved2 field MUST be ignored on receipt: YES) s
390 270 M
(   o  The Responder Validator Option MUST be included: YES) s
390 254 M
(   o  The Responder Validator Option MUST be generated copying the) s
390 246 M
(      Responder Validator option received in the R1 message: YES) s
390 230 M
(   o  When the IPv6 source and destination addresses in the IPv6 header) s
390 222 M
(      do not match the ULID pair, the ULID-pair option MUST be included:) s
390 214 M
(      FEATURE NOT SUPPORTED \(ULID pair option\)) s
390 198 M
(   o  When another instance of an existent context with the same ULID) s
390 190 M
(      pair is being created, a Forked Instance Identifier option MUST be) s
390 182 M
(      included to distinguish this new instance from the existent one:) s
390 174 M
(      FEATURE NOT SUPPORTED \(FII\)) s
390 158 M
(   o  When the Locator List Option is sent, the necessary HBA/CGA) s
390 150 M
(      information for verifying the locator list MUST also be included:) s
390 142 M
(      YES) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 10]) s
_R
S
%%Page: (6) 6
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 6 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (6) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(   o  The CGA PDS option MUST be included when the locator list is) s
5 494 M
(      included: YES.) s
5 478 M
(   o  The CGA Signature option MUST be included when some of the) s
5 470 M
(      locators in the list use CGA \(and not HBA\) for verification: YES) s
5 454 M
(   o  If the initiator does not receive an R2 message after I2_TIMEOUT) s
5 446 M
(      time after sending an I2 message it MAY retransmit the I2 message,) s
5 438 M
(      using binary exponential backoff and randomized timers: YES) s
5 422 M
(   o  In the case that the initiator decides not to retransmit I2) s
5 414 M
(      messages or in the case that the initiator still does not recieve) s
5 406 M
(      an R2 message after retransmitting I2 messages I2_RETRIES_MAX) s
5 398 M
(      times, the initiator SHOULD fall back to retransmitting the I1) s
5 390 M
(      message: YES) s
5 374 M
(   o  A host MUST silently discard any received I2 message that does not) s
5 366 M
(      statisfy all of the following validity checks:) s
5 350 M
(      *  Hdr Ext Len field at least 2: YES) s
5 334 M
(      *  The responder nonce is a recent one.  Nonces that are no older) s
5 326 M
(         than VALIDATOR_MIN_LIFETIME SHOULD be considered recent: YES) s
5 310 M
(      *  the Responder Validator option matches the validator the host) s
5 302 M
(         would have computed for the ULID, locators, responder nonce,) s
5 294 M
(         initiator nonce and FII: YES) s
5 278 M
(      *  If a CGA Parameter Data Structure \(PDS\) is included in the) s
5 270 M
(         message, then the host MUST verify if the actual PDS contained) s
5 262 M
(         in the message corresponds to the ULID\(peer\): YES) s
5 246 M
(      *  If the state is I1-SENT, then the host verifies if the source) s
5 238 M
(         locator is included in Ls\(peer\) or, it is included in the) s
5 230 M
(         Locator List contained in the I2 message and the HBA/CGA) s
5 222 M
(         verification for this specific locator is successful: YES) s
5 206 M
(   o  If a host is in I1-SENT state, receives an I2 message and all the) s
5 198 M
(      above checks are successful, then it MUST send a R2 message back:) s
5 190 M
(      YES) s
5 174 M
(3.5.  R2 Message) s
5 158 M
(   o  The Reserved1 field MUST be ignored on receipt: YES) s
5 142 M
(   o  The R field MUST be ignored on receipt: YES) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 11]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(   o  When the Locator List Option is sent, the necessary HBA/CGA) s
390 494 M
(      information for verifying the locator list MUST also be included:) s
390 486 M
(      YES) s
390 470 M
(   o  Before an R2 message is sent, the host MUST look for a possible) s
390 462 M
(      context confusion: YES \(this is verified at I2/R2 reception\)) s
390 446 M
(   o  A host MUST silently discard any received R2 message that does not) s
390 438 M
(      statisfy all of the following validity checks:) s
390 422 M
(      *  Hdr Ext Len field at least 1: YES) s
390 406 M
(      *  the host looks for an existing context which matches the) s
390 398 M
(         Initiator Nonce and where the locators are contained in) s
390 390 M
(         Ls\(peer\) and Ls\(local\), respectively.  If no such context is) s
390 382 M
(         found, then the R2 message is silently dropped: YES) s
390 366 M
(      *  If state is I1-SENT, I2-SENT or I2BIS-SENT and a CGA Parameter) s
390 358 M
(         Data Structure \(PDS\) is included in the message, then the host) s
390 350 M
(         MUST verify if the actual PDS contained in the message) s
390 342 M
(         corresponds to the ULID\(peer\): YES) s
390 326 M
(   o  Before the host completes the R2 processing it MUST look for a) s
390 318 M
(      possible context confusion: YES) s
390 302 M
(3.6.  R1bis, I2bis) s
390 286 M
(   Those messages are not supported yet.  They are ignored on receipt.) s
390 270 M
(3.7.  Update Request\(UR\)/Acknowledgement\(UA\) messages) s
390 254 M
(   o  The Reserved1 field MUST be ignored on receipt: YES) s
390 238 M
(   o  The R field MUST be ignored on receipt: YES) s
390 222 M
(   o  A host MUST silently discard any received UR/UA message that does) s
390 214 M
(      not statisfy all of the following validity checks:) s
390 198 M
(      *  Hdr Ext Len field at least 1: YES) s
390 182 M
(      *  the host looks for an existing context whose CT\(local\) matches) s
390 174 M
(         the context tag.  If no such context is found, it sends a R1bis) s
390 166 M
(         message: FEATURE NOT SUPPORTED \(R1bis\)) s
390 150 M
(      *  Since context tags can be reused, the host MUST verify that the) s
390 142 M
(         IPv6 source address field is part of Ls\(peer\) and that the IPv6) s
390 134 M
(         destination address field is part of Ls\(local\).  In this case) s
390 126 M
(         the host MUST send a R1bis message, and otherwise ignore the) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 12]) s
_R
S
%%Page: (7) 7
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 7 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (7) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(         UR/UA message: FEATURE NOT SUPPORTED \(R1bis\)) s
5 486 M
(      *  UR only: If a CGA Parameter Data Structure \(PDS\) is included in) s
5 478 M
(         the message, then the host MUST verify if the actual PDS) s
5 470 M
(         contained in the message corresponds to the ULID\(peer\): YES) s
5 454 M
(3.8.  Keepalive and Probe Messages) s
5 438 M
(   o  The Type field must be 66 for a keepalive, 67 for a probe: YES) s
5 422 M
(   o  The Reserved1 and Reserved2 fields MUST be ignored on receipt: YES) s
5 406 M
(   o  The R bit MUST be ignored on receipt: YES) s
5 390 M
(   o  A keepalive MAY contain options: NO \(no option is currently) s
5 382 M
(      defined\)) s
5 366 M
(   o  The first set of sent probe fields of a probe message pertains to) s
5 358 M
(      the currently sent probe message and MUST be present: YES) s
5 342 M
(   o  This value SHOULD be generated using a random number generator) s
5 334 M
(      that is known to have good randomness properties as outlined in) s
5 326 M
(      RFC 4086: YES) s
5 310 M
(   o  If the host is using a non-default Send Timeout value, it SHOULD) s
5 302 M
(      communicate this value as a Keepalive Timeout value to the peer:) s
5 294 M
(      YES) s
5 278 M
(   o  When sending a Probe message, the State field MUST be set to a) s
5 270 M
(      value that matches the conceptual state of the sender after) s
5 262 M
(      sending the Probe: YES) s
5 246 M
(   o  The Reserved field MUST be ignored on receipt: YES) s
5 230 M
(3.9.  Keepalive Timeout Option) s
5 214 M
(   o  This option MAY be sent in the I2, I2bis, R2, or UPDATE messages:) s
5 206 M
(      YES \(The option is sent in I2,R2 and UPDATE messages.  I2bis is) s
5 198 M
(      not yet supported\)) s
5 182 M
(   o  The option SHOULD only need to be sent once in a given shim6) s
5 174 M
(      association.: YES \(However, if Tsend is set manually through the) s
5 166 M
(      shim6c tool, all contexts are updated to reflect the new Tsend) s
5 158 M
(      value.  This implies the sending of an UPDATE message, with the) s
5 150 M
(      keepalive timeout option\).) s
5 134 M
(   o  If a host receives this option it SHOULD update its Keepalive) s
5 126 M
(      Timeout value for the correspondent: YES.  \(Note that LinShim6) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 13]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(      handles Tsend as a global value for the system, and Tka as a per-) s
390 494 M
(      context value\).) s
390 478 M
(   o  The Type field identifies the option and MUST be set to 10) s
390 470 M
(      \(Keepalive Timeout\): YES.) s
390 454 M
(3.10.  Error messages) s
390 438 M
(   FEATURE NOT SUPPORTED) s
390 422 M
(3.11.  Message Options) s
390 406 M
(   o  The length field MUST NOT include the padding: YES) s
390 390 M
(   o  Any added padding bytes MUST be zeroed by the sender: YES) s
390 374 M
(   o  The values of the padding bytes SHOULD NOT be checked by the) s
390 366 M
(      receiver: YES) s
390 350 M
(   o  If C=1 and the option is not recognized by the receiver, then the) s
390 342 M
(      host SHOULD send back a Shim6 error message with Error Code=1,) s
390 334 M
(      with the Pointer referencing the first octet in the Option Type) s
390 326 M
(      field: FEATURE NOT SUPPORTED \(error messages\)) s
390 310 M
(   o  If C=1 and the option is not recognized by the receiver, then the) s
390 302 M
(      rest of the message MUST NOT be processed: YES) s
390 286 M
(   o  Locator Preferences: Any element definition of length greater than) s
390 278 M
(      3 MUST be defined so that the first three bytes agree the) s
390 270 M
(      definition given in the draft: YES \(we do not define longer) s
390 262 M
(      element fields\)) s
390 246 M
(   o  The Reserved2 field of the ULID pair option MUST be ignored on) s
390 238 M
(      receipt: FEATURE NOT SUPPORTED \(ULID pair option\)) s
390 222 M
(   o  If the verification method in the Locator List option is not) s
390 214 M
(      supported by the host, or if the verification method is not) s
390 206 M
(      consistent with the CGA Parameter Data Structure, then the host) s
390 198 M
(      MUST ignore the Locator List and the message in which it is) s
390 190 M
(      contained: YES) s
390 174 M
(   o  If the verification method in the Locator List option is not) s
390 166 M
(      supported by the host, or if the verification method is not) s
390 158 M
(      consistent with the CGA Parameter Data Structure, then the host) s
390 150 M
(      SHOULD generate a Shim6 Error message with Error Code=2, with the) s
390 142 M
(      Pointer referencing the octet in the Verification method that was) s
390 134 M
(      found inconsistent: FEATURE NOT SUPPORTED \(Error messages\)) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 14]) s
_R
S
%%Page: (8) 8
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 8 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (8) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(3.12.  Payload data) s
5 486 M
(   o  The insertion of the Shim6 extension header in payload packets) s
5 478 M
(      MUST NOT cause any recalculation of the ULP checksums: YES) s
5 462 M
(   o  When receiving a packet with a context tag that does not match any) s
5 454 M
(      context, the receiver SHOULD generate a R1bis message: FEATURE NOT) s
5 446 M
(      SUPPORTED \(R1bis\)) s
5 430 M
(   o  If payload data is received with a context tag that matches with a) s
5 422 M
(      context in state I2-SENT or I2BIS-SENT, the host resp. sends back) s
5 414 M
(      a I2 or I2bis and proceeds to process the message: NO \(the message) s
5 406 M
(      is processed only for an ESTABLISHED state\)) s
5 390 M
(3.13.  General requirements of the Shim6 draft) s
5 374 M
(   o  The I1, I2 and I2bis messages MUST contain the ULID pair, either) s
5 366 M
(      in the IPv6 header or in a ULID pair option: YES \(During) s
5 358 M
(      negotiation the locators are always the identifiers, thus the ULID) s
5 350 M
(      pair option is not needed.\)) s
5 334 M
(   o  The context tag MUST be unique for each context: YES) s
5 318 M
(   o  At least 30 bits of the context tag MUST be populated by random or) s
5 310 M
(      pseudo-random bits: YES \(all 47 bits are pseudo-random\)) s
5 294 M
(   o  The host SHOULD randomly cycle through the unstructured tag name) s
5 286 M
(      space: YES) s
5 270 M
(   o  The HBA/CGA verification SHOULD be performed by the host before) s
5 262 M
(      the host acknowledges the new locator, by sending an Update) s
5 254 M
(      Acknowledgement message, or an R2 message: YES) s
5 238 M
(   o  Before a host can use a locator \(different from the ULID\) as the) s
5 230 M
(      destination locator it MUST perform the HBA/CGA verification if) s
5 222 M
(      this was not performed before upon the reception of the locator) s
5 214 M
(      set: YES \(Checked by the daemon upon reception\)) s
5 198 M
(   o  Before a host can use a locator \(different from the ULID\) as the) s
5 190 M
(      destination locator, it MUST verify that the ULID is indeed) s
5 182 M
(      present at that locator.  This verification is performed by doing) s
5 174 M
(      a return- routability test as part of the Probe sub-protocol: YES) s
5 158 M
(   o  I2, I2bis and R2 messages MUST include a sufficiently large set of) s
5 150 M
(      locators in a Locator List option that the peer can determine) s
5 142 M
(      whether or not two contexts have the same host as the peer by) s
5 134 M
(      comparing if there is any common locators in Ls\(peer\):) s
5 126 M
(      CONFIGURABLE \(see Section 2.2.2\)) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 15]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(   o  In case of context confusion detection \([RFC5533]\), the old) s
390 494 M
(      context which used the context tag MUST be removed: YES) s
390 478 M
(   o  An implementation MAY re-create a context to replace the one that) s
390 470 M
(      was removed because of confusion detection: NO \(it is not) s
390 462 M
(      automatically re-created, but it can be negotiated again if the) s
390 454 M
(      heuristic triggers a context establishement or the peer sends a) s
390 446 M
(      new I1\).) s
390 430 M
(   o  It is RECOMMENDED that hosts do not tear down the context when) s
390 422 M
(      they know that there is some upper layer protocol that might use) s
390 414 M
(      the context: PARTIAL SUPPORT \(see Section 2.4\)) s
390 398 M
(   o  The minimum acceptable key length for public keys used in the) s
390 390 M
(      generation of CGAs SHOULD be 1024 bits: YES) s
390 374 M
(   o  in case that IPsec is implemented as Bump-In-The-Wire \(BITW\),) s
390 366 M
(      either the shim MUST be disabled, or the shim MUST also be) s
390 358 M
(      implemented as Bump-In-The-Wire, in order to satisfy the) s
390 350 M
(      requirement that IPsec is layered above the shim: CONFIGURABLE) s
390 342 M
(      \(disable LinShim6 to use a BITW IPsec device\)) s
390 326 M
(   o  If a shim6 node has some protected and some unprotected interfaces) s
390 318 M
(      for the purposes of IPsec, then it MUST treat the locator sets for) s
390 310 M
(      the protected and unprotected interfaces as separate locator sets) s
390 302 M
(      and not intermix them: FEATURE NOT SUPPORTED \(IPsec\).) s
390 286 M
(3.14.  General requirements of the REAP draft) s
390 270 M
(   o  Available addresses are discovered and monitored through) s
390 262 M
(      mechanisms outside the scope of SHIM6.SHIM6 implementations MUST) s
390 254 M
(      be able to employ information provided by IPv6 Neighbor Discovery,) s
390 246 M
(      Address Autoconfiguration, and DHCP \(when DHCP is implemented\).) s
390 238 M
(      This information includes the availability of a new address and) s
390 230 M
(      status changes of existing addresses \(such as when an address) s
390 222 M
(      becomes invalid\): PARTIAL SUPPORT \(Address discovery is performed) s
390 214 M
(      using all mechanisms available in the kernel, but not monitored) s
390 206 M
(      later\)) s
390 190 M
(   o  Locally operational addresses are discovered and monitored through) s
390 182 M
(      mechanisms outside the SHIM6 protocol.SHIM6 implementations MUST) s
390 174 M
(      be able to employ information provided from Neighbor) s
390 166 M
(      Unreachability Detection: NO) s
390 150 M
(   o  Locally operational addresses are discovered and monitored through) s
390 142 M
(      mechanisms outside the SHIM6 protocol.  Implementations MAY also) s
390 134 M
(      employ additional, link layer specific mechanisms: NO) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 16]) s
_R
S
%%Page: (9) 9
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 9 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (9) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(   o  SHIM6 implementations MUST support the discovery of operational) s
5 494 M
(      address pairs through the use of explicit rechability tests and) s
5 486 M
(      Forced Bidirectional Communication \(FBD\), described later in this) s
5 478 M
(      specification: YES) s
5 462 M
(   o  In addition, implementations MAY employ the following additional) s
5 454 M
(      mechanisms:) s
5 438 M
(      *  Positive feedback from upper layer protocols: NO) s
5 422 M
(      *  Negative feedback from upper layer protocols: NO) s
5 406 M
(      *  ICMP error messages: NO) s
5 390 M
(   o  After the reception of a data packet from the peer, REAP keepalive) s
5 382 M
(      packets SHOULD continue to be sent at the Keepalive Interval until) s
5 374 M
(      either a data packet in the SHIM6 context has been sent to the) s
5 366 M
(      peer or the Keepalive Timeout expires: YES) s
5 350 M
(   o  Upon changing to a new address pair, the network path traversed) s
5 342 M
(      most likely has changed, thus the ULP SHOULD be informed: YES \(A) s
5 334 M
(      NETEVENT_PATH_UPDATE notification is generated whenever a new) s
5 326 M
(      address pair is used.  Any entity in the kernel can listen to that) s
5 318 M
(      notification and act accordingly.  Currently only the TCP layer) s
5 310 M
(      listens to the notification, and reacts by resetting its) s
5 302 M
(      Retransmission Timeout\)) s
5 286 M
(   o  Out of the set of possible candidate address pairs, nodes SHOULD) s
5 278 M
(      attempt to test through all of them until an operational pair is) s
5 270 M
(      found, and retrying the process as is necessary: YES) s
5 254 M
(   o  All nodes MUST perform the exploration process sequentially and) s
5 246 M
(      with exponential back-off: YES) s
5 230 M
(   o  The externally observable behaviour of an implementation MUST) s
5 222 M
(      conform to the REAP state machine: YES) s
5 206 M
(   o  Unprotected indications from other parts of the protocol stack) s
5 198 M
(      SHOULD NOT be taken as a proof of connectivity problems: YES) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 17]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(4.  Protocol conformance by feature) s
390 486 M
(   In the following list we make a division of the Shim6 specification) s
390 478 M
(   into several features, in order to easily identify which of them are) s
390 470 M
(   supported and which are not.) s
390 454 M
(   o  Context forking: No \(Only useful if an API exists\)) s
390 438 M
(   o  Context recovery: Not yet) s
390 422 M
(   o  Locator preferences option: Not yet) s
390 406 M
(   o  Locator list updates: YES) s
390 390 M
(   o  Cryptographically Generated Addresses: YES) s
390 374 M
(   o  Hash Based Addresses: YES) s
390 358 M
(   o  Failure detection and recovery: YES) s
390 342 M
(   o  Context confusion detection \([RFC5533] sec. 7.6\): YES) s
390 326 M
(   o  Handling of ICMP error messages: Not yet) s
390 310 M
(   o  Keepalive Timeout Option: YES) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 18]) s
_R
S
%%Page: (10) 10
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 10 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (10) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(5.  Conclusion and further work) s
5 486 M
(   This draft describes the current state of the LinShim6) s
5 478 M
(   implementation, version 0.9.  It uses a heuristic to decide whether) s
5 470 M
(   to trigger a Shim6 negotiation, and it is able to monitor the state) s
5 462 M
(   of the communication thanks to the REAP state machine.  It has been) s
5 454 M
(   shown to successfully support the switch to an alternative locator) s
5 446 M
(   pair, and it is the first known Shim6 implementation that supports) s
5 438 M
(   HBA and CGA.  LinShim6 is still under development.  We aim at finally) s
5 430 M
(   providing the complete set of features.  In the near future we will) s
5 422 M
(   work on context recovery and error messages.  Other missing features) s
5 414 M
(   seem to have a lower priority and are left for later.) s
5 398 M
(   We have established an exhaustive listing of supported and) s
5 390 M
(   unsupported elements of the protocols, which appears as making much) s
5 382 M
(   easier to verify the level of support and security of the protocol.) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 19]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(6.  Acknowledgments) s
390 486 M
(   Sebastien Barre is funded by Trilogy, a research project \(ICT-216372\)) s
390 478 M
(   supported by the European Community under its Seventh Framework) s
390 470 M
(   Programme.  The views expressed here are those of the author\(s\) only.) s
390 462 M
(   The European Commission is not liable for any use that may be made of) s
390 454 M
(   the information in this document.) s
390 438 M
(   Part of this work has been supported by a grant from FRIA \(Fonds pour) s
390 430 M
(   la Formation a la Recherche dans l'Industrie et dans l'Agriculture,) s
390 422 M
(   rue d'Egmont 5 - 1000 Bruxelles, Belgium\).) s
390 406 M
(   John Ronan reviewed this document and provided comments.  He also) s
390 398 M
(   spent many hours testing the code in many different scenarios, giving) s
390 390 M
(   valuable feedback and helping in several tricky bug fixes.  His help) s
390 382 M
(   has been very invaluable to improve LinShim6 overall stability.) s
390 366 M
(   Matthijs Mekking has written a wireshark patch for Shim6, that has) s
390 358 M
(   been very helpful in testing the implementation, and also used) s
390 350 M
(   LinShim6 himself and provided feedback.) s
390 334 M
(   The CGA/HBA support, cgad and cgatool benefitted from much code from) s
390 326 M
(   the DoCoMo SEND implementaion, the clarity of the code made extension) s
390 318 M
(   and adaptation for LinShim6 very effective.) s
390 302 M
(   Francis Dupont has written the very first known implementation of) s
390 294 M
(   HBA.  Although we have written a second one based on DoCoMo SEND) s
390 286 M
(   project, Francis Dupont's work, and especially his test suite, has) s
390 278 M
(   been used to validate our HBA module.) s
390 262 M
(   Other people has helped getting things better by comments, bug) s
390 254 M
(   reports, or discussions: Lu Junxiu, Martin Kulas, Aaron Kunde,) s
390 246 M
(   Sazzadur Rahman, Iljitsch van Beijnum, Marcelo Bagnulo, James Swan,) s
390 238 M
(   Shinta Sugimoto, Masahide Nakamura, Sebastian Meier, Amine Dhraief,) s
390 230 M
(   the INL team.) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 20]) s
_R
S
%%Page: (11) 11
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 11 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (11) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
5 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
5 502 M
(7.  References) s
5 486 M
(   [I-D.ietf-shim6-multihome-shim-api]) s
5 478 M
(              Komu, M., Bagnulo, M., Slavov, K., and S. Sugimoto,) s
5 470 M
(              "Socket Application Program Interface \(API\) for) s
5 462 M
(              Multihoming  Shim", draft-ietf-shim6-multihome-shim-api-09) s
5 454 M
(              \(work in progress\), Jul 2009.) s
5 438 M
(   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate) s
5 430 M
(              Requirement Levels", RFC 2119, Mar 1997.) s
5 414 M
(   [RFC3484]  Draves, R., "Default Address Selection for Internet) s
5 406 M
(              Protocol version 6 \(IPv6\)", RFC 3484, Feb 2003.) s
5 390 M
(   [RFC3549]  Salim, J., Khosravi, H.,  Kleen, A., and A.  Kuznetsov,) s
5 382 M
(              "Linux Netlink as an IP Services Protocol", RFC 3549,) s
5 374 M
(              Jul 2003.) s
5 358 M
(   [RFC5533]  Nordmark, E. and M. Bagnulo, "Shim6: Level 3 Multihoming) s
5 350 M
(              Shim Protocol for IPv6", RFC 5533, Jun 2009.) s
5 334 M
(   [RFC5534]  Arkko, J. and I. van Beijnum, "Failure Detection and) s
5 326 M
(              Locator Pair Exploration Protocol for  IPv6 Multihoming",) s
5 318 M
(              RFC 5534, Jun 2009.) s
5 302 M
(   [KANDA04]  Kanda, M., Miyazawa, K., and H. Esaki, "USAGI IPv6 IPsec) s
5 294 M
(              development for Linux", in International Symposium on) s
5 286 M
(              Applications and the Internet,  pp. 159-163, Jan 2004.) s
5 270 M
(   [BARRE07]  Barre, S. and O. Bonaventure, "Improved Path Exploration) s
5 262 M
(              in shim6-based Multihoming", in SIGCOMM 2007 Workshop) s
5 254 M
(              "IPv6 and the Future of the Internet", Kyoto, Japan,) s
5 246 M
(              Aug 2007.) s
5 230 M
(   [BARRE07b]) s
5 222 M
(              Barre, S. and O. Bonaventure, "Implementing SHIM6 using) s
5 214 M
(              the Linux XFRM framework", in Routing In Next Generation) s
5 206 M
(              workshop, Madrid, Spain, Dec 2007.) s
5 190 M
(   [BARRE08]  Barre, S., "LinShim6 - Implementation of the Shim6) s
5 182 M
(              protocol", Feb 2008, <http://inl.info.ucl.ac.be/) s
5 174 M
(              publications/linshim6-implementation-shim6-protocol>.) s
5 158 M
(   [1]  <http://www.docomolabs-usa.com/lab_opensource.html>) s
5 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 21]) s
390 526 M
(Internet-Draft   Shim6 Implementation Report : LinShim6   September 2009) s
390 502 M
(Authors' Addresses) s
390 486 M
(   Sebastien Barre) s
390 478 M
(   Universite catholique de Louvain) s
390 470 M
(   Place Ste Barbe, 2) s
390 462 M
(   Louvain-la-Neuve  1348) s
390 454 M
(   BE) s
390 438 M
(   Email: sebastien.barre@uclouvain.be) s
390 430 M
(   URI:   http://inl.info.ucl.ac.be/sbarre) s
390 406 M
(   Olivier Bonaventure) s
390 398 M
(   Universite catholique de Louvain) s
390 390 M
(   Place Ste Barbe, 2) s
390 382 M
(   Louvain-la-Neuve  1348) s
390 374 M
(   BE) s
390 358 M
(   URI:   http://inl.info.ucl.ac.be/obo) s
390 94 M
(Barre & Bonaventure      Expires March 28, 2010                [Page 22]) s
_R
S
%%Page: (12) 12
%%BeginPageSetup
_S
90 rotate
36 -577 translate
/pagenum 12 def
/fname (draft-barre-shim6-impl-03.txt) def
/fdir () def
/ftail (draft-barre-shim6-impl-03.txt) def
% User defined strings:
/fmodstr (jeu sep 24 13:57:59 2009) def
/pagenumstr (12) def
/user_header_p false def
/user_footer_p false def
%%EndPageSetup
do_header
_R
S
%%Trailer
%%Pages: 12
%%DocumentNeededResources: font Courier-Bold Courier 
%%EOF
